<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zümriban | Profesyonel Zümre Platformu</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --font-body: 'Poppins', sans-serif; }
        /* --- TEMA TANIMLAMALARI --- */
        body.light-theme {
            --bg-color: #f8f9fa; --card-bg: #ffffff; --sidebar-bg: #ffffff; --text-primary: #212529;
            --text-secondary: #6c757d; --border-color: #dee2e6; --shadow-color: rgba(0, 0, 0, 0.05);
            --primary-color: #0d6efd; --secondary-color: #6c757d; --success-color: #198754; --danger-color: #dc3545;
            --input-bg: #f8f9fa; --hover-bg: #e9ecef;
        }
        body.dark-theme {
            --bg-color: #1a202c; --card-bg: #2d3748; --sidebar-bg: #2d3748; --text-primary: #e5e7eb;
            --text-secondary: #9ca3af; --border-color: #4a5568; --shadow-color: rgba(0, 0, 0, 0.2);
            --primary-color: #3b82f6; --secondary-color: #64748b; --success-color: #22c55e; --danger-color: #ef4444;
            --input-bg: #1f2937; --hover-bg: #4a5568;
        }
        
        html { scroll-behavior: smooth; }
        body { font-family: var(--font-body); background-color: var(--bg-color); color: var(--text-primary); margin: 0; padding: 0; transition: background-color 0.3s ease, color 0.3s ease, font-size 0.2s ease; line-height: 1.6; }
        body.font-size-small { font-size: 14px; } body.font-size-normal { font-size: 16px; } body.font-size-large { font-size: 18px; }
        body.modal-open { overflow: hidden; } .hidden { display: none !important; }

        #splash-screen { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background-color: var(--bg-color); z-index: 9999; display: flex; justify-content: center; align-items: center; transition: opacity 0.5s ease-out; }
        .progress-container { width: 300px; height: 8px; background-color: var(--card-bg); border-radius: 5px; overflow: hidden; border: 1px solid var(--border-color); }
        #progress-bar { width: 0%; height: 100%; background-color: var(--primary-color); transition: width 0.1s linear; }

        #welcome-screen { display: flex; justify-content: center; align-items: center; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background-color: var(--bg-color); z-index: 9998; opacity: 1; transition: opacity 0.5s ease-out; }
        .welcome-box { background-color: var(--card-bg); padding: 40px; border-radius: 15px; box-shadow: 0 10px 30px var(--shadow-color); text-align: center; max-width: 500px; width: 90%; }
        .welcome-box h1 { color: var(--text-primary); border-bottom: 2px solid var(--border-color); padding-bottom: 15px; }
        .welcome-box .tagline { font-size: 1.1em; color: var(--text-secondary); margin-top: -10px; margin-bottom: 25px; font-weight: 500; }

        .app-layout { display: flex; }
        .sidebar { width: 240px; background-color: var(--sidebar-bg); color: var(--text-primary); display: flex; flex-direction: column; transition: transform 0.3s ease-in-out; position: fixed; top: 0; left: 0; height: 100%; z-index: 1001; border-right: 1px solid var(--border-color); box-shadow: 0 0 20px var(--shadow-color); }
        .sidebar-header { padding: 25px 20px; text-align: center; border-bottom: 1px solid var(--border-color); }
        .sidebar-header h1 { color: var(--text-primary); font-size: 1.8em; margin: 0; font-weight: 700; }
        .sidebar-nav { flex-grow: 1; margin-top: 15px; }
        .nav-btn { display: flex; align-items: center; gap: 15px; width: 100%; padding: 15px 25px; border: none; background-color: transparent; color: var(--text-secondary); font-size: 1em; text-align: left; cursor: pointer; transition: background-color 0.2s, color 0.2s; font-weight: 500; border-left: 4px solid transparent; }
        .nav-btn i { width: 20px; text-align: center; font-size: 1.1em; }
        .nav-btn:hover { background-color: var(--hover-bg); color: var(--text-primary); }
        .nav-btn.active { background-color: var(--primary-color); color: white; font-weight: 600; border-left-color: var(--success-color); }
        .sidebar-footer { margin-top: auto; padding: 20px; text-align: center; font-size: 0.8em; color: var(--text-secondary); opacity: 0.7; }
        .sidebar-footer p { margin: 0; line-height: 1.4; }
        
        .main-content { width: 100%; padding: 30px; margin-left: 240px; display: flex; justify-content: center; transition: margin-left 0.3s ease-in-out; }
        .main-content-inner { width: 100%; transition: max-width 0.3s ease-in-out; }
        body.view-mode-mobile .main-content-inner { max-width: 600px; }
        body.view-mode-tablet .main-content-inner { max-width: 800px; }
        body.view-mode-desktop .main-content-inner { max-width: 1100px; }
        
        #session-timer { position: fixed; top: 25px; right: 30px; z-index: 1000; background-color: var(--card-bg); padding: 8px 16px; border-radius: 50px; font-size: 0.9em; font-weight: 500; box-shadow: 0 4px 15px var(--shadow-color); border: 1px solid var(--border-color); color: var(--text-secondary); }
        
        #menu-toggle-btn { display: none; }
        
        .program-container { background: var(--card-bg); padding: 40px; border-radius: 16px; width: 100%; margin-bottom: 30px; border: 1px solid var(--border-color); box-shadow: 0 8px 30px var(--shadow-color); animation: fadeIn 0.8s ease-out forwards; box-sizing: border-box; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        h1, h2 { border-bottom: 2px solid var(--border-color); padding-bottom: 15px; margin: 0 0 30px 0; font-weight: 700; color: var(--text-primary); }
        .program-container h1 { color: var(--primary-color); font-size: 2.2em; }
        .btn { padding: 12px 24px; font-weight: 600; border-radius: 8px; border: none; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; transition: all 0.2s ease; font-size: 1em; }
        .btn-success { background-color: var(--success-color); color: white; } .btn-success:hover { transform: translateY(-2px); box-shadow: 0 4px 15px var(--shadow-color); opacity: 0.9; }
        .btn-danger { background-color: var(--danger-color); color: white; }
        .btn-icon { background: none; border: none; color: var(--text-secondary); cursor: pointer; font-size: 1.2em; } .btn-icon:hover { color: var(--danger-color); }
        .btn-secondary { background-color: var(--secondary-color); color: white; }

        .styled-table { width: 100%; border-collapse: collapse; text-align: left; }
        .styled-table th, .styled-table td { padding: 15px; border-bottom: 1px solid var(--border-color); vertical-align: middle; }
        .styled-table thead { color: var(--text-secondary); font-weight: 600; text-transform: uppercase; font-size: 0.85em; }
        .styled-table tbody tr:hover { background-color: var(--hover-bg); }
        .file-display .btn-sm { padding: 5px 10px; font-size: 0.9em; margin-top: 5px; width: 100%; justify-content: center; }
        .file-item { display: flex; justify-content: space-between; align-items: center; background-color: var(--input-bg); padding: 5px 10px; border-radius: 6px; margin-bottom: 5px; }
        .file-item span { font-style: normal; color: var(--text-primary); }
        .file-item .delete-file-btn { font-size: 0.9em; padding: 0 5px; color: var(--text-secondary); }
        .file-item .delete-file-btn:hover { color: var(--danger-color); }
        .participant-tag { display: inline-block; background-color: var(--secondary-color); color: white; padding: 3px 8px; border-radius: 12px; margin: 2px; font-size: 0.9em; }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; z-index: 1002; backdrop-filter: blur(5px); opacity: 0; transition: opacity 0.3s ease; }
        .modal-overlay.active { display: flex; opacity: 1; }
        .modal-content { background: var(--card-bg); padding: 0; border-radius: 15px; box-shadow: 0 5px 25px var(--shadow-color); width: 90%; max-width: 600px; border: 1px solid var(--border-color); color: var(--text-primary); transform: scale(0.95); opacity: 0; transition: transform 0.3s ease, opacity 0.3s ease; }
        .modal-overlay.active .modal-content { transform: scale(1); opacity: 1; }
        .modal-header { padding: 20px 25px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; }
        .modal-header h2 { margin: 0; border: none; padding: 0; font-size: 1.5em; }
        .modal-body { padding: 25px; } .modal-footer { padding: 15px 25px; border-top: 1px solid var(--border-color); text-align: right; background-color: var(--hover-bg); border-radius: 0 0 15px 15px; }
        .form-group { margin-bottom: 20px; text-align: left; } .form-group label { display: block; font-weight: 600; margin-bottom: 8px; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; box-sizing: border-box; background: var(--input-bg); color: var(--text-primary); font-size: 1em; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 3px var(--primary-color_alpha, rgba(59, 130, 246, 0.3)); }
        .close-btn { color: var(--text-secondary); font-size: 2em; font-weight: bold; cursor: pointer; }

        .settings-btn-group { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; }
        .theme-option-btn, .settings-btn-group button { background: var(--input-bg); padding: 15px; border: 2px solid var(--border-color); width: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 10px; cursor: pointer; transition: all 0.2s ease; font-size: 1em; color: var(--text-primary); border-radius: 8px; }
        .theme-option-btn:hover, .settings-btn-group button:hover { border-color: var(--primary-color); }
        .theme-option-btn.active, .settings-btn-group button.active { border-color: var(--primary-color); background-color: var(--card-bg); color: var(--primary-color); font-weight: 600; }
        .theme-swatch { width: 24px; height: 24px; border-radius: 50%; border: 2px solid var(--border-color); background-color: var(--swatch-bg); }
        .theme-option-btn[data-theme="light"] .theme-swatch { --swatch-bg: #f8f9fa; }
        .theme-option-btn[data-theme="dark"] .theme-swatch { --swatch-bg: #1a202c; }
        
        #toast-container { position: fixed; top: 20px; right: 20px; z-index: 1050; display: flex; flex-direction: column; align-items: flex-end; gap: 10px; }
        .toast-notification { padding: 15px 20px; border-radius: 8px; color: white; font-weight: 500; box-shadow: 0 4px 12px var(--shadow-color); opacity: 0; transform: translateX(100%); transition: transform 0.3s ease-out, opacity 0.3s ease-out; }
        .toast-notification.show { opacity: 1; transform: translateX(0); }
        .toast-notification.success { background-color: var(--success-color); }
        .toast-notification.danger { background-color: var(--danger-color); }
        
        #calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; gap: 10px; }
        #month-display { font-size: 1.5em; font-weight: 600; flex-grow: 1; text-align: center;}
        .calendar-nav-btn { background: var(--input-bg); border: 1px solid var(--border-color); border-radius: 8px; padding: 8px 12px; cursor: pointer; }
        #weekdays { display: grid; grid-template-columns: repeat(7, 1fr); text-align: center; font-weight: 600; color: var(--text-secondary); margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid var(--border-color); }
        #calendar-days { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; }
        .day { min-height: 100px; padding: 8px; border: 1px solid var(--border-color); border-radius: 8px; background-color: var(--card-bg); font-weight: 500; transition: background-color 0.2s; display: flex; flex-direction: column; cursor: pointer;}
        .day:hover { background-color: var(--hover-bg); }
        .day.padding { opacity: 0.4; background: transparent; border-color: transparent; cursor: default; }
        .day.today .day-number { background-color: var(--primary-color); color: white; border-radius: 50%; width: 28px; height: 28px; display: flex; justify-content: center; align-items: center; }
        .event-container { margin-top: 5px; display: flex; flex-direction: column; gap: 4px; overflow: hidden; }
        .event-pill { padding: 4px 8px; border-radius: 5px; font-size: 0.8em; color: white; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .event-toplanti { background-color: var(--success-color); }
        .event-analiz { background-color: var(--danger-color); }
        .day-event-list { list-style: none; padding: 0; }
        .day-event-list li { margin-bottom: 10px; padding: 10px; border-radius: 5px; color: white; }

        @media (max-width: 992px) {
            .main-content { margin-left: 0; padding: 20px; }
            #session-timer { display: none; }
            .sidebar { transform: translateX(-100%); }
            .sidebar.open { transform: translateX(0); box-shadow: 5px 0 15px var(--shadow-color); }
            #menu-toggle-btn { display: block; position: fixed; top: 15px; left: 15px; z-index: 1002; background-color: var(--card-bg); color: var(--text-primary); border: 1px solid var(--border-color); width: 45px; height: 45px; border-radius: 50%; font-size: 1.2em; box-shadow: 0 4px 10px var(--shadow-color); cursor: pointer; transition: transform 0.3s ease-in-out; }
            .sidebar.open ~ .main-content #menu-toggle-btn { transform: translateX(240px); }
            .day { min-height: 60px; padding: 4px; font-size: 0.9em; }
            .event-pill { font-size: 0.7em; padding: 2px 4px; }
        }
    </style>
</head>
<body class="dark-theme font-size-normal view-mode-desktop">

    <div id="splash-screen"><div style="text-align: center;"><h1 style="font-size: 2.2em; margin-bottom: 25px;">Zümriban</h1><div class="progress-container"><div id="progress-bar"></div></div><p id="progress-text" style="margin-top: 15px; font-size: 1em;">Platform Hazırlanıyor... 0%</p></div></div>
    <div id="welcome-screen" class="hidden"><div class="welcome-box"><h1><i class="fas fa-folder-tree"></i> Zümriban</h1><p class="tagline">Öğretmen Zümre Takip İşleri</p><p>Başlamak için lütfen bilgilerinizi girin.</p><form id="login-form"><div class="form-group"><label for="name-input">Adınız Soyadınız</label><input type="text" id="name-input" required><div class="hata-mesaji" id="name-error"></div></div><div class="form-group"><label for="zumre-input">Zümreniz</label><input type="text" id="zumre-input" placeholder="Örn: Biyoloji Zümresi" required><div class="hata-mesaji" id="zumre-error"></div></div><button type="submit" class="btn btn-success" style="width:100%; padding: 15px; font-size: 1.2em;">Platforma Giriş Yap</button></form></div></div>
    
    <div class="app-layout hidden" id="app-layout">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header"><h1><i class="fas fa-folder-tree"></i> Zümriban</h1></div>
            <nav class="sidebar-nav">
                <button class="nav-btn active" data-target="dashboard-app"><i class="fas fa-tachometer-alt"></i> Ana Panel</button>
                <button class="nav-btn" data-target="calendar-app"><i class="fas fa-calendar-days"></i> Takvim</button>
                <button class="nav-btn" data-target="plan-app"><i class="fas fa-calendar-alt"></i> Yıllık Plan</button>
                <button class="nav-btn" data-target="toplanti-app"><i class="fas fa-users-cog"></i> Toplantı Yönetimi</button>
                <button class="nav-btn" data-target="analiz-app"><i class="fas fa-chart-pie"></i> Sınav Analizi</button>
                <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid var(--border-color);"><button class="nav-btn" data-target="settings-app"><i class="fas fa-cog"></i> Ayarlar</button><button class="nav-btn" id="help-btn"><i class="fas fa-question-circle"></i> Yardım & Destek</button></div>
            </nav>
            <footer class="sidebar-footer"><p>MuGöl EDUCATION<br>tarafından yapılmıştır.</p></footer>
        </aside>
        
        <main class="main-content" id="main-content">
            <button id="menu-toggle-btn"><i class="fas fa-bars"></i></button>
            <div id="session-timer"></div>
            <div class="main-content-inner">
                <div id="dashboard-app" class="program-container"><h1 id="dashboard-welcome"></h1><div class="info-block" id="dashboard-info"></div></div>
                <div id="calendar-app" class="program-container hidden"><h1>Akıllı Zümre Takvimi</h1><div id="calendar-header"><button id="prev-month-btn" class="calendar-nav-btn"><i class="fas fa-chevron-left"></i></button><h2 id="month-display" style="border:none; padding:0; margin:0;"></h2><button id="today-btn" class="btn btn-secondary">Bugün</button><button id="next-month-btn" class="calendar-nav-btn"><i class="fas fa-chevron-right"></i></button></div><div id="weekdays"><div>Pzt</div><div>Sal</div><div>Çar</div><div>Per</div><div>Cum</div><div>Cmt</div><div>Paz</div></div><div id="calendar-days"></div></div>
                <div id="plan-app" class="program-container hidden"><h1>Yıllık Plan Yönetimi</h1><div style="margin-bottom: 20px;"><button id="add-plan-row-btn" class="btn btn-success"><i class="fas fa-plus"></i> Yeni Hafta Ekle</button></div><div class="table-wrapper"><table class="styled-table"><thead><tr><th>Ay</th><th>Hafta</th><th>Konu/Kazanımlar</th><th>Dosyalar</th><th>İşlemler</th></tr></thead><tbody id="plan-table-body"></tbody></table></div></div>
                <div id="toplanti-app" class="program-container hidden"><h1>Zümre Toplantı Yönetimi</h1><div style="margin-bottom: 20px;"><button id="add-toplanti-btn" class="btn btn-success"><i class="fas fa-plus"></i> Yeni Toplantı Ekle</button></div><div class="table-wrapper"><table class="styled-table"><thead><tr><th>Tarih</th><th>Gündem</th><th>Katılımcılar</th><th>İşlemler</th></tr></thead><tbody id="toplanti-table-body"></tbody></table></div></div>
                <div id="analiz-app" class="program-container hidden"><h1>Sınav Sonuç Analizleri</h1><div style="margin-bottom: 20px;"><button id="add-analiz-btn" class="btn btn-success"><i class="fas fa-plus"></i> Yeni Analiz Ekle</button></div><div class="table-wrapper"><table class="styled-table"><thead><tr><th>Tarih</th><th>Sınav Türü</th><th>Başarı %</th><th>Dosyalar</th><th>İşlemler</th></tr></thead><tbody id="analiz-table-body"></tbody></table></div></div>
                <div id="settings-app" class="program-container hidden"><h2>Ayarlar</h2><div class="form-group"><h3 style="margin-bottom: 15px;">Uygulama Teması</h3><div class="settings-btn-group" id="theme-options"><button class="theme-option-btn" data-theme="light"><div class="theme-swatch"></div> Açık</button><button class="theme-option-btn" data-theme="dark"><div class="theme-swatch"></div> Koyu</button></div></div><div class="form-group"><h3 style="margin-bottom: 15px;">Yazı Tipi Boyutu</h3><div class="settings-btn-group" id="font-size-options"><button data-size="small">Küçük</button><button data-size="normal">Normal</button><button data-size="large">Büyük</button></div></div><div class="form-group"><h3 style="margin-bottom: 15px;">Görünüm Modu</h3><div class="settings-btn-group" id="view-mode-options"><button data-mode="mobile">Telefon</button><button data-mode="tablet">Tablet</button><button data-mode="desktop">Laptop</button></div></div></div>
            </div>
        </main>
    </div>

    <div id="appModal" class="modal-overlay"><div class="modal-content"><div class="modal-header"><h2 id="modal-title"></h2><span class="close-btn">&times;</span></div><div id="modal-body" class="modal-body"></div></div></div>
    <div id="contactModal" class="modal-overlay"><div class="modal-content"><div class="modal-header"><h2>Yardım & Destek</h2><span class="close-btn">&times;</span></div><div class="modal-body"><p>Sorularınızı veya geri bildirimlerinizi bize gönderin.</p><form id="contactForm"><div class="form-group"><label for="contactSubject">Konu:</label><input type="text" id="contactSubject" required></div><div class="form-group"><label for="contactBody">Mesajınız:</label><textarea id="contactBody" rows="4" required></textarea></div><div class="modal-footer"><button type="submit" class="btn btn-success">E-posta Gönder</button></div></form></div></div></div>
    <div id="toast-container"></div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const storage = { get: (k, d = []) => JSON.parse(localStorage.getItem(k)) || d, set: (k, v) => localStorage.setItem(k, JSON.stringify(v)) };
        let nav = 0; 
        
        const showToast = (message, type = 'success') => {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast-notification ${type}`;
            toast.textContent = message;
            container.appendChild(toast);
            setTimeout(() => { toast.classList.add('show'); }, 10);
            setTimeout(() => { toast.classList.remove('show'); toast.addEventListener('transitionend', () => toast.remove()); }, 3000);
        };
        
        const applyTheme = (theme) => { document.body.className = `${theme} ${storage.get('zumriban_fontSize', 'font-size-normal')} ${storage.get('zumriban_viewMode', 'view-mode-desktop')}`; document.querySelectorAll('#theme-options .theme-option-btn').forEach(b => b.classList.toggle('active', b.dataset.theme === theme.replace('-theme', ''))); storage.set('zumriban_theme', theme); };
        const applyFontSize = (size) => { document.body.classList.remove('font-size-small', 'font-size-normal', 'font-size-large'); document.body.classList.add(size); document.querySelectorAll('#font-size-options button').forEach(b => b.classList.toggle('active', b.dataset.size === size.replace('font-size-', ''))); storage.set('zumriban_fontSize', size); };
        const applyViewMode = (mode) => { document.body.classList.remove('view-mode-mobile', 'view-mode-tablet', 'view-mode-desktop'); document.body.classList.add(mode); document.querySelectorAll('#view-mode-options button').forEach(b => b.classList.toggle('active', b.dataset.mode === mode.replace('view-mode-', ''))); storage.set('zumriban_viewMode', mode); };

        const modal = document.getElementById('appModal'), contactModal = document.getElementById('contactModal');
        const openModal = (title, bodyHtml, targetModal = modal) => { targetModal.querySelector('#modal-title, h2').textContent = title; targetModal.querySelector('.modal-body').innerHTML = bodyHtml; targetModal.classList.add('active'); document.body.classList.add('modal-open'); };
        const closeModal = () => { [modal, contactModal].forEach(m => m.classList.remove('active')); document.body.classList.remove('modal-open'); };
        [modal, contactModal].forEach(m => m.querySelector('.close-btn').onclick = closeModal);
        window.onclick = e => { if (e.target.classList.contains('modal-overlay')) closeModal(); };

        const renderPlan = () => {
            const data = storage.get('zumriban_plan');
            document.getElementById('plan-table-body').innerHTML = data.map(item => {
                const files = Array.isArray(item.dosya) ? item.dosya : (item.dosya ? [item.dosya] : []);
                const fileHtml = files.map(f => `<div class="file-item"><span>${f}</span><button class="btn-icon delete-file-btn" data-filename="${f}"><i class="fas fa-times"></i></button></div>`).join('');
                return `<tr data-id="${item.id}"><td contenteditable="true" data-field="ay">${item.ay}</td><td contenteditable="true" data-field="hafta">${item.hafta}</td><td contenteditable="true" data-field="konu">${item.konu}</td><td class="file-display">${fileHtml}<button class="btn btn-sm btn-secondary add-file-btn"><i class="fas fa-paperclip"></i> Dosya Ekle</button></td><td><button class="btn-icon delete-btn"><i class="fas fa-trash"></i></button></td></tr>`;
            }).join('');
        };
        const renderToplantilar = () => {
            const data = storage.get('zumriban_toplantilar');
            document.getElementById('toplanti-table-body').innerHTML = data.map(item => {
                const participants = Array.isArray(item.katilimcilar) ? item.katilimcilar : (item.katilimcilar ? item.katilimcilar.split(',').map(k=>k.trim()) : []);
                const participantsHtml = participants.map(p => `<span class="participant-tag">${p}</span>`).join(' ');
                return `<tr data-id="${item.id}"><td>${item.tarih}</td><td>${item.gundem}</td><td>${participantsHtml}</td><td><button class="btn-icon delete-btn"><i class="fas fa-trash"></i></button></td></tr>`;
            }).join('');
        };
        const renderAnalizler = () => {
            const data = storage.get('zumriban_analizler');
            document.getElementById('analiz-table-body').innerHTML = data.map(item => {
                const files = Array.isArray(item.dosya) ? item.dosya : (item.dosya ? [item.dosya] : []);
                const fileHtml = files.map(f => `<div class="file-item"><span>${f}</span><button class="btn-icon delete-file-btn" data-filename="${f}"><i class="fas fa-times"></i></button></div>`).join('');
                return `<tr data-id="${item.id}"><td>${item.tarih}</td><td>${item.tur}</td><td>%${item.basari}</td><td class="file-display">${fileHtml}<button class="btn btn-sm btn-secondary add-file-btn"><i class="fas fa-paperclip"></i> Dosya Ekle</button></td><td><button class="btn-icon delete-btn"><i class="fas fa-trash"></i></button></td></tr>`;
            }).join('');
        };
        
        const renderCalendar = () => {
            const calendarDays = document.getElementById('calendar-days');
            const monthDisplay = document.getElementById('month-display');
            const dt = new Date();
            if (nav !== 0) { dt.setMonth(new Date().getMonth() + nav); }
            const month = dt.getMonth(), year = dt.getFullYear();
            const firstDayOfMonth = new Date(year, month, 1);
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const firstDayOfWeek = (firstDayOfMonth.getDay() === 0) ? 6 : firstDayOfMonth.getDay() - 1;
            monthDisplay.innerText = `${dt.toLocaleDateString('tr-tr', { month: 'long' })} ${year}`;
            calendarDays.innerHTML = '';
            const toplantilar = storage.get('zumriban_toplantilar');
            const analizler = storage.get('zumriban_analizler');
            for(let i = 1; i <= firstDayOfWeek + daysInMonth; i++) {
                const daySquare = document.createElement('div');
                daySquare.classList.add('day');
                const dayOfMonth = i - firstDayOfWeek;
                if (i > firstDayOfWeek) {
                    const currentDateString = new Date(year, month, dayOfMonth).toLocaleDateString('fr-CA'); // YYYY-MM-DD
                    daySquare.dataset.date = currentDateString;
                    const dayNumberSpan = document.createElement('span');
                    dayNumberSpan.className = 'day-number';
                    dayNumberSpan.innerText = dayOfMonth;
                    daySquare.appendChild(dayNumberSpan);
                    const eventContainer = document.createElement('div');
                    eventContainer.classList.add('event-container');
                    daySquare.appendChild(eventContainer);
                    toplantilar.forEach(item => { if(item.tarih === currentDateString) { const eventDiv = document.createElement('div'); eventDiv.className = 'event-pill event-toplanti'; eventDiv.innerText = item.gundem; eventContainer.appendChild(eventDiv); } });
                    analizler.forEach(item => { if(item.tarih === currentDateString) { const eventDiv = document.createElement('div'); eventDiv.className = 'event-pill event-analiz'; eventDiv.innerText = item.tur || 'Sınav'; eventContainer.appendChild(eventDiv); } });
                    if (dayOfMonth === new Date().getDate() && nav === 0) { daySquare.classList.add('today'); }
                } else { daySquare.classList.add('padding'); }
                calendarDays.appendChild(daySquare);
            }
        };

        const handleAddFiles = (type, id) => {
            openModal('Dosya Ekle', `
                <form id="add-file-form">
                    <div class="form-group">
                        <label>Eklenecek dosyaları seçin:</label>
                        <input type="file" name="files" class="form-control" multiple required>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-success">Dosyaları Yükle</button>
                    </div>
                </form>
            `);
            document.getElementById('add-file-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const fileInput = e.target.querySelector('input[type="file"]');
                if (fileInput.files.length === 0) return;
                
                const storageKey = `zumriban_${type}`;
                let data = storage.get(storageKey);
                const item = data.find(i => i.id == id);
                if (item) {
                    if (!Array.isArray(item.dosya)) item.dosya = item.dosya ? [item.dosya] : [];
                    Array.from(fileInput.files).forEach(file => item.dosya.push(file.name));
                    storage.set(storageKey, data);
                    
                    if (type === 'plan') renderPlan();
                    else if (type === 'analizler') renderAnalizler();
                    
                    closeModal();
                    showToast(`${fileInput.files.length} dosya başarıyla eklendi.`);
                }
            });
        };
        
        const setupEventListeners = () => {
            const sidebar = document.getElementById('sidebar'), menuToggleBtn = document.getElementById('menu-toggle-btn'), menuIcon = menuToggleBtn.querySelector('i');
            const updateMenuIcon = () => { menuIcon.className = sidebar.classList.contains('open') ? 'fas fa-times' : 'fas fa-bars'; };
            document.querySelector('.sidebar-nav').addEventListener('click', e => {
                const button = e.target.closest('.nav-btn'); if (!button) return;
                if (window.innerWidth <= 992 && sidebar.classList.contains('open')) { sidebar.classList.remove('open'); updateMenuIcon(); }
                if (button.id === 'help-btn') { contactModal.classList.add('active'); document.body.classList.add('modal-open'); return; }
                const targetId = button.dataset.target;
                if (targetId) { document.querySelector('.nav-btn.active').classList.remove('active'); button.classList.add('active'); document.querySelectorAll('.program-container').forEach(p => p.classList.toggle('hidden', p.id !== targetId)); if (targetId === 'calendar-app') { renderCalendar(); } }
            });
            menuToggleBtn.addEventListener('click', (e) => { e.stopPropagation(); sidebar.classList.toggle('open'); updateMenuIcon(); });
            document.getElementById('main-content').addEventListener('click', () => { if (sidebar.classList.contains('open')) { sidebar.classList.remove('open'); updateMenuIcon(); } });

            const planTableBody = document.getElementById('plan-table-body');
            planTableBody.addEventListener('click', e => {
                const row = e.target.closest('tr'); if (!row) return; const id = row.dataset.id;
                if (e.target.closest('.delete-btn')) { storage.set('zumriban_plan', storage.get('zumriban_plan').filter(i => i.id != id)); renderPlan(); showToast('Hafta başarıyla silindi.', 'danger'); }
                if (e.target.closest('.add-file-btn')) { handleAddFiles('plan', id); }
                if (e.target.closest('.delete-file-btn')) { const filename = e.target.closest('.delete-file-btn').dataset.filename; let data = storage.get('zumriban_plan'); const item = data.find(i => i.id == id); if (item && Array.isArray(item.dosya)) { item.dosya = item.dosya.filter(f => f !== filename); storage.set('zumriban_plan', data); renderPlan(); showToast('Dosya başarıyla silindi.', 'danger'); } }
            });
            planTableBody.addEventListener('input', e => { const id = e.target.closest('tr').dataset.id; const field = e.target.dataset.field; const value = e.target.textContent; let data = storage.get('zumriban_plan'); const item = data.find(i => i.id == id); if (item) item[field] = value; storage.set('zumriban_plan', data); });
            
            document.getElementById('add-plan-row-btn').addEventListener('click', () => {
                 openModal('Yeni Hafta Ekle', `<form id="modal-form"><div class="form-group"><label>Ay</label><input type="text" name="ay" required></div><div class="form-group"><label>Hafta</label><input type="text" name="hafta" required></div><div class="form-group"><label>Konu/Kazanımlar</label><input type="text" name="konu" required></div><div class="form-group"><label>Dosya Ekle (Opsiyonel)</label><input type="file" name="dosya" accept=".pdf,.doc,.docx,.xls,.xlsx,.txt" multiple></div><div class="modal-footer"><button type="submit" class="btn btn-success">Kaydet</button></div></form>`);
                 document.getElementById('modal-form').addEventListener('submit', e => { e.preventDefault(); const formData = new FormData(e.target); const fileInput = e.target.querySelector('input[type="file"]'); const dosyaListesi = fileInput.files.length > 0 ? Array.from(fileInput.files).map(f => f.name) : []; let data = storage.get('zumriban_plan'); data.push({ id: Date.now(), dosya: dosyaListesi, ay: formData.get('ay'), hafta: formData.get('hafta'), konu: formData.get('konu') }); storage.set('zumriban_plan', data); renderPlan(); closeModal(); showToast('Yeni hafta başarıyla eklendi.'); });
            });
            
            document.getElementById('add-toplanti-btn').addEventListener('click', () => {
                openModal('Yeni Toplantı Ekle', `<form id="modal-form"><div class="form-group"><label>Tarih</label><input type="date" name="tarih" required></div><div class="form-group"><label>Gündem</label><input type="text" name="gundem" required></div><div class="form-group"><label>Katılımcılar (Virgülle ayırın)</label><textarea name="katilimcilar" required rows="3"></textarea></div><div class="modal-footer"><button type="submit" class="btn btn-success">Kaydet</button></div></form>`);
                document.getElementById('modal-form').addEventListener('submit', e => { e.preventDefault(); const formData = new FormData(e.target); const participants = formData.get('katilimcilar').split(',').map(p => p.trim()).filter(Boolean); let data = storage.get('zumriban_toplantilar'); data.push({ id: Date.now(), tarih: formData.get('tarih'), gundem: formData.get('gundem'), katilimcilar: participants }); storage.set('zumriban_toplantilar', data); renderToplantilar(); renderCalendar(); closeModal(); showToast('Yeni toplantı başarıyla eklendi.'); });
            });
            document.getElementById('toplanti-table-body').addEventListener('click', e => { if (e.target.closest('.delete-btn')) { const id = e.target.closest('tr').dataset.id; storage.set('zumriban_toplantilar', storage.get('zumriban_toplantilar').filter(i => i.id != id)); renderToplantilar(); renderCalendar(); showToast('Toplantı başarıyla silindi.', 'danger'); } });
            
            document.getElementById('add-analiz-btn').addEventListener('click', () => {
                openModal('Yeni Sınav Analizi Ekle', `<form id="modal-form"><div class="form-group"><label>Sınav Tarihi</label><input type="date" name="tarih" required></div><div class="form-group"><label>Sınav Türü</label><input type="text" name="tur" required></div><div class="form-group"><label>Başarı Oranı (%)</label><input type="number" name="basari" min="0" max="100" required></div><div class="form-group"><label>Dosya Ekle (Opsiyonel)</label><input type="file" name="dosya" multiple></div><div class="modal-footer"><button type="submit" class="btn btn-success">Kaydet</button></div></form>`);
                document.getElementById('modal-form').addEventListener('submit', e => { e.preventDefault(); const formData = new FormData(e.target); const fileInput = e.target.querySelector('input[type="file"]'); const dosyaListesi = fileInput.files.length > 0 ? Array.from(fileInput.files).map(f => f.name) : []; let data = storage.get('zumriban_analizler'); const newData = { id: Date.now(), dosya: dosyaListesi, tarih: formData.get('tarih'), tur: formData.get('tur'), basari: formData.get('basari') }; data.push(newData); storage.set('zumriban_analizler', data); renderAnalizler(); renderCalendar(); closeModal(); showToast('Yeni analiz başarıyla eklendi.'); });
            });
            const analizTableBody = document.getElementById('analiz-table-body');
            analizTableBody.addEventListener('click', e => {
                const row = e.target.closest('tr'); if (!row) return; const id = row.dataset.id;
                if (e.target.closest('.delete-btn')) { storage.set('zumriban_analizler', storage.get('zumriban_analizler').filter(i => i.id != id)); renderAnalizler(); renderCalendar(); showToast('Analiz başarıyla silindi.', 'danger'); }
                if (e.target.closest('.add-file-btn')) { handleAddFiles('analizler', id); }
                if (e.target.closest('.delete-file-btn')) { const filename = e.target.closest('.delete-file-btn').dataset.filename; let data = storage.get('zumriban_analizler'); const item = data.find(i => i.id == id); if (item && Array.isArray(item.dosya)) { item.dosya = item.dosya.filter(f => f !== filename); storage.set('zumriban_analizler', data); renderAnalizler(); showToast('Dosya başarıyla silindi.', 'danger'); } }
            });

            document.getElementById('next-month-btn').addEventListener('click', () => { nav++; renderCalendar(); });
            document.getElementById('prev-month-btn').addEventListener('click', () => { nav--; renderCalendar(); });
            document.getElementById('today-btn').addEventListener('click', () => { nav = 0; renderCalendar(); });
            document.getElementById('calendar-days').addEventListener('click', e => {
                const daySquare = e.target.closest('.day');
                if (!daySquare || !daySquare.dataset.date) return;
                const date = daySquare.dataset.date;
                const toplantilar = storage.get('zumriban_toplantilar').filter(item => item.tarih === date);
                const analizler = storage.get('zumriban_analizler').filter(item => item.tarih === date);
                let bodyHtml = '<p>Bu tarihe ait etkinlik bulunmamaktadır.</p>';
                if (toplantilar.length > 0 || analizler.length > 0) {
                    bodyHtml = '<ul class="day-event-list">';
                    toplantilar.forEach(item => { bodyHtml += `<li class="event-toplanti"><strong>Toplantı:</strong> ${item.gundem}</li>`; });
                    analizler.forEach(item => { bodyHtml += `<li class="event-analiz"><strong>Sınav Analizi:</strong> ${item.tur}</li>`; });
                    bodyHtml += '</ul>';
                }
                const formattedDate = new Date(date).toLocaleDateString('tr-TR', { day: 'numeric', month: 'long', year: 'numeric', timeZone: 'UTC' });
                openModal(`${formattedDate} Etkinlikleri`, bodyHtml);
            });
            
            document.getElementById('theme-options').addEventListener('click', e => { if (e.target.closest('button')) applyTheme(e.target.closest('button').dataset.theme + '-theme'); });
            document.getElementById('font-size-options').addEventListener('click', e => { if (e.target.closest('button')) applyFontSize('font-size-' + e.target.closest('button').dataset.size); });
            document.getElementById('view-mode-options').addEventListener('click', e => { if (e.target.closest('button')) applyViewMode('view-mode-' + e.target.closest('button').dataset.mode); });
            document.getElementById('contactForm').addEventListener('submit', e => { e.preventDefault(); const user = JSON.parse(sessionStorage.getItem('zumribanUser')); const subject = e.target.querySelector('#contactSubject').value; const body = e.target.querySelector('#contactBody').value; const mailtoBody = `Merhaba,\n\n${body}\n\nSaygılarımla,\n${user.name}\n(${user.zumre})\n\n---\nZümriban Uygulaması Üzerinden Gönderildi`; window.location.href = `mailto:mugol.education.help@gmail.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(mailtoBody)}`; closeModal(); });
        };
        
        function startSessionTimer() {
            const timerElement = document.getElementById('session-timer'); if (!timerElement) return; const startTime = Date.now();
            setInterval(() => { const elapsed = Math.floor((Date.now() - startTime) / 1000); const hours = String(Math.floor(elapsed / 3600)).padStart(2, '0'); const minutes = String(Math.floor((elapsed % 3600) / 60)).padStart(2, '0'); const seconds = String(elapsed % 60).padStart(2, '0'); timerElement.innerHTML = `<i class="far fa-clock"></i> Oturum Süresi: ${hours}:${minutes}:${seconds}`; }, 1000);
        }
        
        const startApp = (user) => {
            document.getElementById('welcome-screen').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('welcome-screen').classList.add('hidden');
                const appLayout = document.getElementById('app-layout');
                appLayout.classList.remove('hidden'); appLayout.classList.add('fade-in');
                document.getElementById('dashboard-welcome').textContent = `Hoş geldiniz, ${user.name}!`;
                document.getElementById('dashboard-info').innerHTML = `<p><strong>${user.zumre}</strong> çalışma alanındasınız.</p>`;
                applyTheme(storage.get('zumriban_theme', 'dark-theme'));
                applyFontSize(storage.get('zumriban_fontSize', 'font-size-normal'));
                applyViewMode(storage.get('zumriban_viewMode', 'view-mode-desktop'));
                if(!localStorage.getItem('zumriban_plan')) { storage.set('zumriban_plan', [{ id: Date.now(), ay: 'Eylül', hafta: '3. Hafta', konu: 'Örnek Kazanım', dosya: [] }]); }
                renderPlan(); renderToplantilar(); renderAnalizler(); setupEventListeners(); startSessionTimer(); renderCalendar(); 
            }, 500);
        };
        
        let progress = 0; const interval = setInterval(() => {
            progress += 2; document.getElementById('progress-bar').style.width = progress + '%'; document.getElementById('progress-text').textContent = `Platform Hazırlanıyor... ${progress}%`;
            if (progress >= 100) {
                clearInterval(interval);
                document.getElementById('splash-screen').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('splash-screen').classList.add('hidden');
                    const savedUser = sessionStorage.getItem('zumribanUser');
                    if (savedUser) { startApp(JSON.parse(savedUser)); }
                    else { document.getElementById('welcome-screen').classList.remove('hidden'); }
                }, 500);
            }
        }, 20);

        document.getElementById('login-form').addEventListener('submit', e => {
            e.preventDefault();
            const user = { name: document.getElementById('name-input').value.trim(), zumre: document.getElementById('zumre-input').value.trim() };
            let isValid = true;
            if (!user.name) { document.getElementById('name-error').textContent = 'Ad alanı zorunludur.'; isValid = false; } else { document.getElementById('name-error').textContent = ''; }
            if (!user.zumre) { document.getElementById('zumre-error').textContent = 'Zümre alanı zorunludur.'; isValid = false; } else { document.getElementById('zumre-error').textContent = ''; }
            if (isValid) { sessionStorage.setItem('zumribanUser', JSON.stringify(user)); startApp(user); }
        });
    });
    </script>
</body>
</html>